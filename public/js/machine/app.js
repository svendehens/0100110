const TEST_MODE=!0,MAX_RESULTS_PER_BOX=15,MAX_SEARCH_RESULTS=75,WINDOW_WIDTH=250,WINDOW_HEIGHT=300,WRITE_WINDOW_WIDTH=400,WRITE_WINDOW_HEIGHT=250,TIMING_HINT_IMAGE=5e3,TIMING_HINT_IMAGE_FADEOUT=3e3,TIMING_HINT_IMAGE_ONSCREEN=5e3,TIMING_TYPEIN_WORD=3e3,TIMING_HINT_MESSAGE_1=15e3,HINT_MESSAGE_1=["well, waiting got you this far, but not much further, so select one of the text excerpts that look like they could be interesting.","ok, find a text that looks like it could be interesting. click on it.","which of the excerpts above look promising to you? click on it."],HINT_MESSAGE_2=["this is the paragraph which hosted the excerpt..now, find another text. if theres nothing that looks attractive, try scrolling through any of the columns of examples til you find one and click on that.","find another text fragment that looks promising. click.","now click on another text that seems interesting."],HINT_MESSAGE_3=["if either of these new text windows need to be moved, just grab the L (ikon) in the upper left of the text window and move it.anyway, now in these two texts you'll see the original searchterm ('search', remember), underlined. click and drag one ‘search’ to the other. a blue line and a blue text. a synthesis of the two."],HINT_MESSAGE_4=["also at the top of this text area, to the right, you’ll find the title of the work from which this paragraph was taken. a click on that will bring up a larger excerpt of the text, but before you do that, below the author and title is a line with a slider. click the crossbar and slide to the right. constious words will be highlighted gray. it calculates relevance. the further right, the larger the scope of relevance. link any two highlighted words from any two texts. red line and text. link red and red or blue, green text.the synonyms and wikipedia and twitter associations you dont need me for."],ELIZA_MESSAGES=["does %word interest you?","what does %word suggest to you?","is %word much on your mind?","do you feel strongly discussing about %word?"],BY_TERM_JSON="https://test.wikipedia.org/w/api.php?action=query&format=json&origin=*&titles=",THES_JSON="http://words.bighugelabs.com/api/2/173aaf6b8cc559ac582b75f5ef7a8c8c/",WIKI_API_URL="http://en.wikipedia.org/w/api.php?action=query&prop=revisions&rvprop=content&rvslots=*&format=json&pageids=",MARKOV_URL="",SEARCH_ALL_URL="",SEARCH_URL="",LIST_URL="",BLUE_ENDPOINT_OPTS={endpoint:"Rectangle",paintStyle:{width:25,height:20,fillStyle:"#555"},isSource:!0,connectorStyle:{strokeStyle:"#00F"},isTarget:!0,anchor:"TopCenter"},RED_ENDPOINT_OPTS={endpoint:"Rectangle",paintStyle:{width:25,height:20,fillStyle:"#555"},isSource:!0,connectorStyle:{strokeStyle:"#F00"},isTarget:!0,anchor:"TopCenter"},GREEN_ENDPOINT_OPTS={endpoint:"Rectangle",paintStyle:{width:25,height:20,fillStyle:"#555"},isSource:!0,connectorStyle:{strokeStyle:"#00FF00"},isTarget:!0,anchor:"TopCenter"};let descriptionWindow=[],grids=[],writingBox=null,suggestionBox=null,suggestionList="",searchCount=0,openedTextCount=0,linksMade=0,no_action=!0,texts_opened=0,synths_made=0,nonblue_synths_made=0,windowIndex=0,blueTexts={},desktop_demo=!1,idle=!0;var browser=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===n[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),{name:n[0],version:n[1]})}();function sortJSON(e,t){return null==e.outLinks?null:"relatedness"==t?e.outLinks.sort((function(e,t){return parseFloat(t.relatedness)-parseFloat(e.relatedness)})):e.outLinks.sort((function(e,t){return e.title>t.title?1:-1}))}function checkRegexp(e,t,n){return!!t.test(e.val())}function scrollToAnchor(e,t,n){var i=$("#"+n+" a[name='"+e+"']");t.animate({scrollTop:i.offset().top-80},"fast")}function getURLParameter(e){return decodeURI((RegExp(e+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}var autoRefresh=function(e){var t,n=function(){clearInterval(t),t=setTimeout((function(){location.href=location.href}),1e3*e)};$(document).on("keypress, click, mousemove",(function(){n(),detectFirstActivity()})),n()};function generateMarkov(e,t,n,i,o,r){var s=openWindow(t,n,2e3,250,300,"<div class='red_text_cont'>..."+e+"...</div>","","red_text",!0),a=s.window.getContainer().find(".red_text_cont").height();s.window.resize(250,a+40),$(s.window.getContainer()).find(".window_frame").height(a+30),$(s.window.getContainer()).find(".window_frame").highlight(i),$(s.window.getContainer()).find(".window_frame").highlight(o),jsPlumb.addEndpoint($("#"+s.window.getContainer().attr("id")+" .highlight"),GREEN_ENDPOINT_OPTS),jsPlumb.draggable(s.window.getContainer()),blueTexts[r.source]=s}function triggerHintImage(e){setTimeout((function(){no_action&&($(".hint_screenshot").css("display","block"),$(".hint_screenshot").animate({opacity:1},2e3),setTimeout((function(){no_action&&$(".hint_screenshot").animate({opacity:0},3e3,(function(){$(".hint_screenshot").css("display","none"),setTimeout((function(){no_action&&0==$("#search_box").val().length&&typeInSearch()}),3e3)}))}),5e3))}),e)}function typeInSearch(){var e="search";$("#search_box").val(""),showText("#search_box",e,0,400,!0),setTimeout((function(){search($("#search_box"))}),400*(e.length+2))}$((function(){triggerHintImage(5e3),"MSIE"!=browser.name&&"Edge"!=browser.name||alert("machine for making sense has been designed and tested on Firefox and Chrome"),$("#search_box").val(""),openWriteBox(),typeInSearch(),$(".search_box").trigger("focus"),$(".search_box").trigger("select"),jsPlumb.ready((function(){jsPlumb.Defaults.Container=$("body"),jsPlumb.importDefaults({ConnectorZIndex:4e3,Connector:"Straight",PaintStyle:{lineWidth:1,strokeStyle:"#00F"},Anchors:["TopCenter","BottomCenter"]}),jsPlumb.bind("jsPlumbConnection",(function(e){$(".window_frame #hint_message").fadeOut(500),$(".window_frame #hint_message").text(""),synths_made++;const t=e.source.parent().text(),n=e.target.parent().text(),i=e.source.parents(".window_panel"),o=e.target.parents(".window_panel"),r=(e.source.position().left+e.target.position().left+i.position().left+o.position().left)/2-125,s=(e.source.position().top+e.target.position().top+i.position().top+o.position().top)/2-50;if(e.source.hasClass("wm_wikifiedLink")){nonblue_synths_made++;const n=e.source.text(),i=e.target.text();$.getJSON("/search?keyword="+n+"&max=10",(function(o){$.getJSON("/search?keyword="+i+"&max=10",(function(a){if(console.log("targetword data2",a),null==result1||null==result2){t.length>2e3&&(t=t.substring(0,2e3));var l=t.length<200?t.length:.6*t.length;$.ajax({url:"/markov?order=5&begining="+n+"&length="+l+"&content="+t,context:document.body}).done((function(t){generateMarkov(t,r,s,n,i,e)}))}else{const t=o[Math.floor(Math.random()*o.length)],l=a[Math.floor(Math.random()*a.length)];$.getJSON("search2.php?id="+t.id+"&wordIndex="+t.wordIndex,(function(t){$.getJSON("search2.php?id="+l.id+"&wordIndex="+l.wordIndex,(function(o){const a=Math.round((t[0].body.length+o[0].body.length)/2);$.ajax({url:"/markov?order=5&begining="+n+"&length="+a+"&content="+t[0].body+" "+o[0].body,context:document.body}).done((function(t){generateMarkov(t,r,s,n,i,e)}))}))}))}}))})),e.source.css("color","#F00"),e.target.css("color","#F00")}else{const i=e.source.parents(".red_text").length>0||e.source.parents(".blue_text").length>0||e.target.parents(".red_text").length>0||e.target.parents(".blue_text").length>0?"green":"blue",o=Math.round((t.length+n.length)/2),a="blue"==i?6:4;"blue"==i&&0==nonblue_synths_made&&setTimeout((function(){0==nonblue_synths_made&&writeHintMessage(4)}),1e4),$.ajax({url:"/markov?order="+a+"&begining="+e.source.text()+"&length="+o+"&content="+t+" "+n,context:document.body}).done((function(t){var n=openWindow(r,s,2e3,250,300,"<div class='"+i+"_text_cont'>..."+t+"...</div>","",i+"_text",!0),o=n.window.getContainer().find("."+i+"_text_cont").height();n.window.resize(250,o+40),$(n.window.getContainer()).find(".window_frame").height(o+30),blueTexts[e.source]=n,"green"!=i&&($(n.window.getContainer()).find(".window_frame").highlight(e.source.text()),$(n.window.getContainer()).find(".window_frame").highlight(e.target.text()),jsPlumb.addEndpoint($("#"+n.window.getContainer().attr("id")+" .highlight"),GREEN_ENDPOINT_OPTS),jsPlumb.draggable(n.window.getContainer()))})),e.source.css("color","#00F"),e.target.css("color","#00F")}linksMade++})),jsPlumb.bind("jsPlumbConnectionDetached",(function(e){e.source.css("color","#666"),e.target.css("color","#666"),console.log(e),blueTexts[e.source].window.close()}))}))}));var showTextBusy="",showText=function(e,t,n,i,o){if(showTextBusy==t||""==showTextBusy)if(showTextBusy=t,n<t.length){var r=o?$(e).val():$(e).text();o?$(e).val(r+t[n++]):$(e).text(r+t[n++]),setTimeout((function(){showText(e,t,n,i,o)}),i)}else n==t.length&&(showTextBusy="")};function addSelectionToBox(){var e=getSelectedText(),t=$.trim($(".window_container .write_note_box").val());t=t+" "+e,$(".window_container .write_note_box").val(t)}function getSelectedText(){return window.getSelection?window.getSelection():document.selection?document.selection.createRange().text:""}function openWriteBox(){let e=$(window).height()-250-5,t=$(window).width()/2-200;if(null==writingBox){let n=$("#write_window").html();writingBox=$.window({title:" ",content:n,resizable:!0,width:400,height:250,x:t,y:e,z:3e3,containerClass:"write_container",afterResize:function(e){let t=e.getContainer()[0].offsetWidth-50,n=e.getContainer()[0].offsetHeight-80;$(e.getContainer().find(".write_note_box")[0]).css("width",t+"px"),$(e.getContainer().find(".write_note_box")[0]).css("height",n+"px")}}),$(".window_function_bar").css("display","block")}else writingBox.isMinimized()&&writingBox.restore();return!1}function getGridForElement(e){var t=$(e).parents(".window_container"),n=$(t).find(".grid_index").val();return textContent=grids[n]}function openWindow(e,t,n,i,o,r,s,a,l){return descriptionWindow[windowIndex]=$.window({title:null!=s?s:" ",content:r,resizable:!0,width:i,height:o,x:e,y:t,resizable:l,containerClass:a}),grids[windowIndex]=new GridElement(windowIndex,descriptionWindow[windowIndex]),windowIndex++,grids[windowIndex-1]}function search(e){no_action=!1;var t=$("#search_box").val();return t.length<2||(searchByTerm(t),openWriteBox(),setTimeout((function(){0==texts_opened&&writeHintMessage(1)}),15e3)),!1}function writeHintMessage(e){if(""==showTextBusy){var t;switch($(".window_frame #hint_message").show(),$(".window_frame #hint_message").text(""),e){case 1:t=HINT_MESSAGE_1;break;case 2:t=HINT_MESSAGE_2;break;case 3:t=HINT_MESSAGE_3;break;case 4:t=HINT_MESSAGE_4;break;default:t=ELIZA_MESSAGES,e=e.toLowerCase()}var n=t[Math.round(10*Math.random())%t.length]+" \t \n";n=n.replace("%word",e);showText(".window_frame #hint_message",n,0,80,!1);n.length}}function searchByTerm(e){$(".window_frame #hint_message").text("");var t="";e.indexOf(",")>0&&(t=e.substring(0,e.indexOf(",")).trim(),e=e.substring(e.indexOf(",")+1).trim()),$.getJSON("search-all?keyword="+e+"&author="+t,searchCallback(e)),setTimeout((function(){searchWikiminer(e.toLowerCase())}),2e3),setTimeout((function(){thesaurusSyns(e.toLowerCase())}),2e3),suggestionList=""}function searchTwitterCallback(){return function(e){e.results.length>0&&$(".window_frame #twitter_result").text(e.results[0].text)}}function searchCallback(e){return function(t){var n="";null===t&&(n="No results");var i="",o=0,r=0,s=0,a=0,l=t&&t.length>75?75/t.length:1;$.each(t,(function(c,d){var u="";if(u=(u=(u=u+"<li>"+d.author+", "+d.title)+'<input type="hidden" id="search_result_hidden_index" value="'+d.wordIndex+'"/>')+'<p><a href="#" onclick="search_result(this,'+d.id+","+d.wordIndex+",'"+e+"');return false;\">"+d.sentence+"</a></p></li>",l<1?i==d.author?r++:Math.random()<1?(n+=u,s++,o++):r++:(n+=u,o++,s++),i=d.author,o>15||r+s==t.length){n='<div class="window_container"><div class="result_container"><ul class="results_box">'+n+"</ul></div></div>";var h=300+40*Math.random(),p=250*a*.91+searchCount%2*250/2+10,f=55+30*Math.random()-15+searchCount%4*100;p+250+20>$(document).width()&&(f+=50,p%=$(document).width());var g=openWindow(p,f,2e3,250,h,n,"","search_container",!0).window;$(g.getContainer()).find(".results_box p").highlight(e,{wordsOnly:!0}),n="",a++,o=0}})),t&&t.length>0&&searchCount++,$(".search_box")[0].value="",$(".write_container .write_note_box").trigger("focus")}}function search_result(e,t,n,i){var o=e.parentNode.parentNode;return $.getJSON("search?id="+t+"&wordIndex="+n,searchResultCallback($(o),i,-1==n)),texts_opened++,$(".window_frame #hint_message").fadeOut(500),$(".window_frame #hint_message").text(""),1==texts_opened&&setTimeout((function(){1==texts_opened&&writeHintMessage(2)}),5e3),2==texts_opened&&0==synths_made&&setTimeout((function(){0==synths_made&&writeHintMessage(3)}),5e3),!1}function searchResultCallback(e,t,n){return function(i){var o,r=i[0],s=r.content,a="text_section";n&&(a+=" large_text_section"),s.replace(/â€™/g,"'"),o=`\n            <div class="${a}">\n                <h2>\n                    <a href="#" onclick="list_titles(this,'${t}','${r.author}');return false;">${r.author}</a>\n                    , <a href="#" onclick="search_result(this,${r.id},-1,'${t}');return false">${r.name}</a>\n                </h2>\n                <div class="wikify_slider"></div>\n                <p>${s}</p>\n            </div>\n        `;var l=$(e).parents(".window_panel"),c=$(l).position().top;createWindow($(l).position().left,c,o,t)}}function createWindow(e,t,n,i){t<5&&(t=5),(e=e+250+20+20*Math.random())+250>$(document).width()&&(e-=500);var o=openWindow(e,t,2e3,250,300,n,"","result_box",!0).window,r=12+openedTextCount%3+"px";openedTextCount++,$(o.getContainer()).find(".text_section").css("line-height",r);var s=$(o.getContainer()).find(".text_section").height()+30;s<800?(o.resize(250,1.1*s+20),$(o.getContainer()).find(".window_frame").height(s+15)):console.log("height: large"),$(o.getContainer()).find(".wikify_slider").slider({max:100,value:0,stop:function(e,t){var n=$(e.target).parents(".window_frame").find(".text_section p");wikifyText(n.text(),1-t.value/100,n)}}),$(o.getContainer()).find(".wikify_slider a").attr("title","slide for relevance"),""!=i&&($(o.getContainer()).find(".text_section p").highlight(i,{wordsOnly:!0}),jsPlumb.addEndpoint($("#"+o.getContainer().attr("id")+" .highlight"),BLUE_ENDPOINT_OPTS),linksMade<3?($("#"+o.getContainer().attr("id")+" .highlight").attr("title","drag to any other anchor word to link"),$("._jsPlumb_endpoint").attr("title","drag to any other anchor word to link")):linksMade>=3&&($(".highlight").attr("title",""),$("._jsPlumb_endpoint").attr("title","")),jsPlumb.draggable(o.getContainer()))}function wikifyText(e,t,n){console.log("cannot wikify")}function wikifyCallback(e,t){var n=t.parents(".window_panel"),i=t.parents(".window_frame").find(".highlight"),o=i.length>0?$(i[0]).text():void 0;t.html(e),o&&(n.find(".window_frame p").highlight(o),jsPlumb.addEndpoint($("#"+n.attr("id")+" .highlight"),BLUE_ENDPOINT_OPTS)),jsPlumb.addEndpoint($("#"+n.attr("id")+" .wm_wikifiedLink"),RED_ENDPOINT_OPTS),jsPlumb.draggable(n),$(n).find(".window_frame").scroll((function(){$.doTimeout("scroll",1e3,(function(){console.log("scroll"),jsPlumb.repaintEverything()}))})),linksMade<3?($("#"+n.attr("id")+" .wm_wikifiedLink").attr("title","drag to any other anchor word to synthesize"),$("._jsPlumb_endpoint").attr("title","drag to any other anchor word to synthesize")):linksMade>=3&&($(".highlight").attr("title",""),$("._jsPlumb_endpoint").attr("title","")),t.find(".wm_wikifiedLink").click((function(e){return queryWikipediaApiById($(e.target).parents(".window_panel").position().left,$(e.target).parents(".window_panel").position().top,$(e.target).attr("pageId")),!1}))}function queryWikipediaApiById(e,t,n){return $.ajax({type:"GET",url:WIKI_API_URL+n,dataType:"json",success:function(i){openWikiWindow(i,e,t,n)}}),!1}function openWikiWindow(e,t,n,i){var o=e.query.search[0].snippet,r=txtwiki.parseWikitext(o);r=r.replace(/{{(.*?)}}/g,"");var s=`<div class="wikify_slider"></div>\n        <div class="text_section">\n          <h2>${e.query.search[0].title}</h2>\n          <p>${r}</p>\n        </div>`;0==t&&0==n&&(t=20+200*Math.random(),n=30+50*Math.random()),writeHintMessage(e.query.search[0].title),setTimeout((function(){""==showTextBusy&&$(".window_frame #hint_message").text("")}),7e3),createWindow(t,n,s,"")}function searchResultNewBox(e,t){var n=getGridForElement(e).window.getContainer()[0],i=openAdjacentWindow(e,$("#desc_window").html(),n),o=$(e.parentNode.parentNode).find(".search_result_hidden")[0].value;i.changeMode("search_result");var r=descriptionWindow[windowIndex-1].getFrame().find("ul");$.getJSON("search?id="+o,searchResultCallback(r))}function list_titles(e,t,n){e.parentNode.parentNode;return console.log("accessing list titles"),!1}function listTitlesCallback(e,t,n){return function(i){var o='<ul class="title_list">',r="";$.each(i,(function(e,n){var i="";n.author!=r&&(r=n.author,i='<a name="'+n.author+'"/>'),o+="<li>"+i+n.author+', <a href="#" onclick="search_result(this,'+n.id+",-1,'"+t+"');return false\">"+n.name+"</a></li>"})),o+="</ul>";var s=$(e).parents(".window_panel"),a=$(s).position().top+20*Math.random(),l=$(s).position().left;a<5&&(a=5),(l=l+250+20+20*Math.random())+250>$(document).width()&&(l-=500);var c=openWindow(l,a,2e3,250,300,o,"","result_box",!0);scrollToAnchor(n,$(c.window.getContainer()).find(".window_frame"),c.window.getContainer().attr("id"))}}function thesaurusSyns(e){$.getJSON(THES_JSON+e+"/json",(function(e){var t="";for(var n in e)null!=n&&$.each(e[n].syn,(function(e,n){e<5&&(t+='<li><a href="#" onclick="searchByTerm(\''+n+"');return false;\"> "+n+"</li>",e++)}));suggestionList.length>0&&(suggestionList+="<li>&nbsp;</li>"),suggestionList+=t,$(".write_container .suggestions").html('<ul class="wiki_suggestions">'+suggestionList+"</ul>")}))}function searchWikiminer(e){processArticleJSON(BY_TERM_JSON+e,e)}function processArticleJSON(e,t){$.ajax({url:"https://en.wikipedia.org/w/api.php",jsonp:"callback",dataType:"jsonp",data:{action:"query",list:"search",srsearch:t,format:"json"},xhrFields:{withCredentials:!0},success:function(e){openWikiWindow(e,0,0,e.query.search[0].pageid)}}),$.getJSON(e,(function(e){json_cache=e;var t=sortJSON(e,"relatedness");if(null!=t){var n="";$.each(t,(function(e,t){e<7&&(n+='<li><a href="#" onclick="queryWikipediaApiById(0,0,\''+t.id+"');return false;\"> "+t.title.toLowerCase()+" </a></li>",e++)})),suggestionList.length>0&&(suggestionList+="<li>&nbsp;</li>"),suggestionList+=n,$(".write_container .suggestions").html('<ul class="wiki_suggestions">'+suggestionList+"</ul>")}}))}function save_to_desktop(){var e=$(".window_frame #write_textarea").val();window.open("save.php?method=desktop&content="+e,"_self")}function send_email(){var e=$(".window_frame #write_textarea").val(),t=prompt("email address (separated by comma)");null!=t&&""!=t&&$.ajax({url:"save.php?method=email&content="+e+"&to="+t,context:document.body}).done((function(){console.log("ajax done")}))}function contact_email(){var e=$(".window_frame #write_textarea").val(),t="dehens.sven@gmail.com";""!=e&&$.ajax({url:"save.php?method=email&content="+e+"&to="+t,context:document.body}).done((function(){console.log("ajax done"),alert("thanks")}))}var searchHintCount=0;function searchHint(e){e?($(".search_hint").show(),searchHintCount++):$(".search_hint").hide()}function searchKeyup(e,t){$(".hint_screenshot").css("display","none"),13==t.keyCode&&(search(e),no_action=!1)}function GridElement(e,t){this.index=e,this.window=t,this.mode="search",this.window.getContainer().find(".change_to_wiki").css("display","none"),this.window.getContainer().find(".grid_index").val(e)}GridElement.prototype.getX=function(){return this.window.getContainer().css("top")},GridElement.prototype.getY=function(){return this.window.getContainer().css("left")},GridElement.prototype.getResultContainer=function(){return this.window.getContainer().find(".result_container")},GridElement.prototype.getSearchBox=function(){return this.window.getContainer().find(".search_box")},GridElement.prototype.getNoteBox=function(){return this.window.getContainer().find(".note_box")},GridElement.prototype.getTextContent=function(){return this.window.getContainer().find(".results_box p").text()},GridElement.prototype.changeMode=function(e){if(e!=this.mode){var t=this.window.getContainer();switch(e){case"search_result":t.find(".change_to_note").css("display","none"),t.find(".change_to_wiki").css("display","inline");break;case"note":t.find(".search_box").remove(),t.find(".results_box").remove(),$("<textarea/>").addClass("note_box").insertAfter(t.find(".checkboxes")),t.find(".change_to_note").css("display","none"),t.find(".change_to_wiki").css("display","none")}this.mode=e}},GridElement.prototype.toJson=function(){var e=this;return e.x=Math.round(this.getX().replace("px","")),e.y=Math.round(this.getY().replace("px","")),e.html_content=this.window.getContainer().find(".result_container").html(),e.scroll=Math.round(this.window.getContainer().find(".window_frame").scrollTop()),e};var txtwiki=function(){function e(e,t,n,i){if(e.slice(t,t+n.length)==n){t+=n.length;var o=e.indexOf(i,t);return-1==o&&(o=e.length),{text:e.slice(t,o),pos:o+i.length}}return{text:null,pos:t}}function t(e,n){if("[["==e.slice(n,n+2)){var i="";for(n+=2;"]]"!=e.slice(n,n+2);)if("[["==e.slice(n,n+2)){var o=t(e,n);i+=o.text,n=o.pos}else i+=e[n],n++;n+=2;var r=i.split("|");return 1==r.length?{text:r[0],pos:n}:"File:"==r[0].slice(0,5)?{text:"",pos:n}:{text:r[1],pos:n}}return{text:null,pos:n}}function n(e,t){if("<ref"==e.slice(t,t+4)){t+=4;var n=e.slice(t),i=n.search(/<\/ref>|\/>/);return"</ref>"==n.slice(i,i+6)?{text:n.slice(0,i),pos:t+i+6}:{text:n.slice(0,i),pos:t+i+2}}return{text:null,pos:t}}function i(e){for(var t=[],n=0,i=0,o=e,r=0,s=0;-1!==(r=o.search(/''([^']|$)/));)s+=r,"'''"===o.slice(r-3,r)?(t.push({pos:s-3,type:"b"}),t.push({pos:s,type:"i"}),i+=1,n+=1):"'"===o[r-1]?(t.push({pos:s-1,type:"b"}),i+=1):(t.push({pos:s,type:"i"}),n+=1),s+=2,o=o.slice(r+2);if(i%2+n%2==2)for(r=0;r<t.length;r++)if("b"===t[r].type&&(void 0===t[r+1]||t[r+1].pos-t[r].pos!=3)){(" "===e[(s=t[r].pos)-2]&&" "!==e[s-2]||" "!==e[s-2]&&" "!==e[s-2]||" "===e[s-2])&&(t[r].pos+=1,t[r].type="i",i-=1,n+=1);break}n%2==1&&(t.push({pos:e.length,type:"i"}),e+="''"),i%2==1&&t.push({pos:e.length,type:"b"});var a="";if(0!==t.length){for(s=0,r=0;r<t.length;r++)a+=e.slice(s,t[r].pos),s="b"===t[r].type?t[r].pos+3:t[r].pos+2;"''"!==e.slice(e.length-2,e.length)&&(a+=e.slice(s,e.length))}else a=e;return a}function o(e){for(var t="",n=(e=e.replace(/ +/g," ")).split("\n"),i=0;i<n.length;i++)n[i].match(/^\s*$/)?t+="\n\n":n[i].match(/^==+.+==+$/)?t+=n[i]+"\n":t+=n[i];return t=(t=t.replace(/\n\n+/g,"\n\n")).replace(/(^\n*|\n*$)/g,"")}var r={parseWikitext:function(r){var s="";r=function(t){var n,i="",o=0;for(;o<t.length;)!("<"==t[o]&&null!=(n=e(t,o,"\x3c!--","--\x3e")).text||"{"==t[o]&&null!=(n=e(t,o,"{|","|}")).text)?(i+=t[o],o++):o=n.pos;return i}(r=o(r)),r=function(e){var i,o="",r=0;for(;r<e.length;)"<"!=e[r]||null==(i=n(e,r)).text?"["!=e[r]||null==(i=t(e,r)).text?(o+=e[r],r++):(r=i.pos,o+=i.text):r=i.pos;return o}(r);for(var a=r.split("\n"),l=0;l<a.length;l++)0!==a[l].length?(a[l]=i(a[l]),s+=a[l]+"\n"):s+="\n";return s=o(s)}};if("undefined"==typeof module||!module.exports)return r;module.exports=r}();function init(){switch(sourceMode){case 2:document.getElementById("sourceMode_html").checked=!0;break;case 3:document.getElementById("sourceMode_wiki").checked=!0;break;default:document.getElementById("sourceMode_auto").checked=!0}switch(repeatMode){case 0:document.getElementById("repeatMode_all").checked=!0;break;case 1:document.getElementById("repeatMode_first").checked=!0;break;default:document.getElementById("repeatMode_fis").checked=!0}var e=document.getElementById("tab_rawHtml");if(null!=e){var t=e.innerHTML;(i=t.indexOf(">"))>0&&(t=t.substring(i+1)),(o=t.lastIndexOf("<"))>0&&(t=t.substring(0,o)),t=(t=t.replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e.innerHTML=t}var n=document.getElementById("tab_wiki");if(null!=n){var i,o,r=n.innerHTML;(i=r.indexOf(">"))>0&&(r=r.substring(i+1)),(o=r.lastIndexOf("<"))>0&&(r=r.substring(0,o));for(var s,a="",l=0,c=/\[\[(.*?)(|.*?)\]\]/g;null!=(s=c.exec(r));)a=(a+=r.substring(l,s.index))+'<a href="http://www.en.wikipedia.org/wiki/'+getDestination(s[0])+'">'+s[0]+"</a>",l=c.lastIndex;a+=r.substring(l),n.innerHTML=a}0==sourceMode&&2==repeatMode&&.5==minProbability&&""==bannedTopics||showOptions(),addTooltipsToAllLinks($("#tab_renderedHtml")),addTooltipsToAllLinks($(n)),addTooltipsToAllLinks($("#tab_topics"))}function getDestination(e){var t=e.indexOf("|");return t>0?e.substring(2,t):e.substring(2,e.length-2)}function selectTab(e){for(var t=document.getElementsByName("tab"),n=0;n<t.length;n++)t[n].className="tabDeselected";var i=document.getElementsByName("outputBox");for(n=0;n<t.length;n++)i[n].style.display="none";document.getElementById("tab_"+e).className="tabSelected",document.getElementById("box_"+e).style.display="block"}function showOptions(){$("#inputBox_container").css("margin-right","430px"),$("#options").show(),$("#hideOptions").show(),$("#showOptions").hide()}function hideOptions(){$("#inputBox_container").css("margin-right","12px"),$("#options").hide(),$("#hideOptions").hide(),$("#showOptions").show()}function getPageDimensions(){var e=0,t=0;return"number"==typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth,t=document.body.clientHeight),new Dimension(e,t)}function Dimension(e,t){this.width=e,this.height=t}function addTooltipsToAllLinks(e){if(null!=e)for(var t=e.find("a"),n=0;n<t.length;n++){var i=$(t[n]),o=i.attr("href"),r=i.attr("linkProb");null!=o&&"http://www.en.wikipedia.org/wiki/"==o.substr(0,33)&&(i.unbind("mouseover"),i.bind("mouseover",{id:idsByTitle[o.substr(33).toLowerCase()],object:i,linkProb:r},(function(e){showTooltip(e.data.id,e.data.object,e.data.linkProb)})),i.unbind("mouseout"),i.bind("mouseout",(function(e){$("#tooltip").hide()})))}}function showTooltip(e,t,n){var i=$("#tooltip"),o=t.offset().top+t.height(),r=t.offset().left;r+i.width()>$(window).width()&&(r=$(window).width()-i.width()-30),i.css("top",o+"px"),i.css("left",r+"px"),i.html("<div class='loading'></div>"),i.show(),console.log("accessing showtooltip wikify 216")}function processTooltipResponse(e,t,n){var i=$("#tooltip");i.empty();var o=$(t).find("Image");o.length>0&&i.append("<img src='"+o.attr("url")+"'></img>");var r=$(t).find("Definition");r.length>0?i.append(r.text()):i.append("no definition avaliable"),null!=n&&i.append("<p><em>"+n+"</em> probability of being a link"),$(i).append("<br/>")}!function(e){e.fn.dragscrollable=function(t){var n=e.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},t||{}),i={mouseDownHandler:function(t){return!(1!=t.which||!t.data.acceptPropagatedEvent&&t.target!=this)&&(t.data.lastCoord={left:t.clientX,top:t.clientY},e.event.add(document,"mouseup",i.mouseUpHandler,t.data),e.event.add(document,"mousemove",i.mouseMoveHandler,t.data),t.data.preventDefault?(t.preventDefault(),!1):void 0)},mouseMoveHandler:function(e){var t=e.clientX-e.data.lastCoord.left,n=e.clientY-e.data.lastCoord.top;if(e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-t),e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-n),e.data.lastCoord={left:e.clientX,top:e.clientY},e.data.preventDefault)return e.preventDefault(),!1},mouseUpHandler:function(t){if(e.event.remove(document,"mousemove",i.mouseMoveHandler),e.event.remove(document,"mouseup",i.mouseUpHandler),t.data.preventDefault)return t.preventDefault(),!1}};this.each((function(){var t={scrollable:e(this),acceptPropagatedEvent:n.acceptPropagatedEvent,preventDefault:n.preventDefault};e(this).find(n.dragSelector).bind("mousedown",t,i.mouseDownHandler)}))}}(jQuery),jQuery.extend({highlight:function(e,t,n,i){if(3===e.nodeType){var o=e.data.match(t);if(o){var r=document.createElement(n||"span");r.className=i||"highlight";var s=e.splitText(o.index);s.splitText(o[0].length);var a=s.cloneNode(!0);return r.appendChild(a),s.parentNode.replaceChild(r,s),1}}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&(e.tagName!==n.toUpperCase()||e.className!==i))for(var l=0;l<e.childNodes.length;l++)l+=jQuery.highlight(e.childNodes[l],t,n,i);return 0}}),jQuery.fn.unhighlight=function(e){var t={className:"highlight",element:"span"};return jQuery.extend(t,e),this.find(t.element+"."+t.className).each((function(){var e=this.parentNode;e.replaceChild(this.firstChild,this),e.normalize()})).end()},jQuery.fn.highlight=function(e,t){var n={className:"highlight",element:"span",caseSensitive:!1,wordsOnly:!1};if(jQuery.extend(n,t),e.constructor===String&&(e=[e]),e=jQuery.grep(e,(function(e,t){return""!=e})),0==(e=jQuery.map(e,(function(e,t){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}))).length)return this;var i=n.caseSensitive?"":"i",o="("+e.join("|")+")";n.wordsOnly&&(o="\\b"+o+"\\b");var r=new RegExp(o,i);return this.each((function(){jQuery.highlight(this,r,n.element,n.className)}))},function(e){var t={},n="doTimeout",i=Array.prototype.slice;function o(n){var o,r=this,s={},a=n?e.fn:e,l=arguments,c=4,d=l[1],u=l[2],h=l[3];function p(){n?o.removeData(n):d&&delete t[d]}function f(){s.id=setTimeout((function(){s.fn()}),u)}if("string"!=typeof d&&(c--,d=n=0,u=l[1],h=l[2]),n?(o=r.eq(0)).data(n,s=o.data(n)||{}):d&&(s=t[d]||(t[d]={})),s.id&&clearTimeout(s.id),delete s.id,h)s.fn=function(e){"string"==typeof h&&(h=a[h]),!0!==h.apply(r,i.call(l,c))||e?p():f()},f();else{if(s.fn)return void 0===u?p():s.fn(!1===u),!0;p()}}e[n]=function(){return o.apply(window,[0].concat(i.call(arguments)))},e.fn[n]=function(){var e=i.call(arguments),t=o.apply(this,[n+e[0]].concat(e));return"number"==typeof e[0]||"number"==typeof e[1]?this:t}}(jQuery),function(e,t,n){e.fn.jScrollPane=function(t){function i(t,i){var o,r,s,a,l,c,d,u,h,p,f,g,w,m,v,_,b,x,y,k,j,T,$,C,S,E,I,M,N,B,H,P,W,D,O=this,A=!0,L=!0,R=!1,G=!1,F=t.clone(!1,!1).empty(),Y=e.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";function z(i){var k,A,L,R,G,F,de,ue=!1,he=!1;if(o=i,r===n)G=t.scrollTop(),F=t.scrollLeft(),t.css({overflow:"hidden",padding:0}),s=t.innerWidth()+W,a=t.innerHeight(),t.width(s),r=e('<div class="jspPane" />').css("padding",P).append(t.children()),l=e('<div class="jspContainer" />').css({width:s+"px",height:a+"px"}).append(r).appendTo(t);else{if(t.css("width",""),ue=o.stickToBottom&&((de=d-a)>20&&de-se()<10),he=o.stickToRight&&function(){var e=c-s;return e>20&&e-re()<10}(),(R=t.innerWidth()+W!=s||t.outerHeight()!=a)&&(s=t.innerWidth()+W,a=t.innerHeight(),l.css({width:s+"px",height:a+"px"})),!R&&D==c&&r.outerHeight()==d)return void t.width(s);D=c,r.css("width",""),t.width(s),l.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}r.css("overflow","auto"),c=i.contentWidth?i.contentWidth:r[0].scrollWidth,d=r[0].scrollHeight,r.css("overflow",""),p=(h=d/a)>1,(f=(u=c/s)>1)||p?(t.addClass("jspScrollable"),(k=o.maintainPosition&&(m||b))&&(A=re(),L=se()),p&&(l.append(e('<div class="jspVerticalBar" />').append(e('<div class="jspCap jspCapTop" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragTop" />'),e('<div class="jspDragBottom" />'))),e('<div class="jspCap jspCapBottom" />'))),x=l.find(">.jspVerticalBar"),y=x.find(">.jspTrack"),g=y.find(">.jspDrag"),o.showArrows&&($=e('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",q(0,-1)).bind("click.jsp",ae),C=e('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",q(0,1)).bind("click.jsp",ae),o.arrowScrollOnHover&&($.bind("mouseover.jsp",q(0,-1,$)),C.bind("mouseover.jsp",q(0,1,C))),J(y,o.verticalArrowPositions,$,C)),j=a,l.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each((function(){j-=e(this).outerHeight()})),g.hover((function(){g.addClass("jspHover")}),(function(){g.removeClass("jspHover")})).bind("mousedown.jsp",(function(t){e("html").bind("dragstart.jsp selectstart.jsp",ae),g.addClass("jspActive");var n=t.pageY-g.position().top;return e("html").bind("mousemove.jsp",(function(e){K(e.pageY-n,!1)})).bind("mouseup.jsp mouseleave.jsp",V),!1})),X()),f&&(l.append(e('<div class="jspHorizontalBar" />').append(e('<div class="jspCap jspCapLeft" />'),e('<div class="jspTrack" />').append(e('<div class="jspDrag" />').append(e('<div class="jspDragLeft" />'),e('<div class="jspDragRight" />'))),e('<div class="jspCap jspCapRight" />'))),S=l.find(">.jspHorizontalBar"),E=S.find(">.jspTrack"),v=E.find(">.jspDrag"),o.showArrows&&(N=e('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",q(-1,0)).bind("click.jsp",ae),B=e('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",q(1,0)).bind("click.jsp",ae),o.arrowScrollOnHover&&(N.bind("mouseover.jsp",q(-1,0,N)),B.bind("mouseover.jsp",q(1,0,B))),J(E,o.horizontalArrowPositions,N,B)),v.hover((function(){v.addClass("jspHover")}),(function(){v.removeClass("jspHover")})).bind("mousedown.jsp",(function(t){e("html").bind("dragstart.jsp selectstart.jsp",ae),v.addClass("jspActive");var n=t.pageX-v.position().left;return e("html").bind("mousemove.jsp",(function(e){ee(e.pageX-n,!1)})).bind("mouseup.jsp mouseleave.jsp",V),!1})),I=l.innerWidth(),U()),function(){if(f&&p){var t=E.outerHeight(),n=y.outerWidth();j-=t,e(S).find(">.jspCap:visible,>.jspArrow").each((function(){I+=e(this).outerWidth()})),I-=n,a-=n,s-=t,E.parent().append(e('<div class="jspCorner" />').css("width",t+"px")),X(),U()}f&&r.width(l.outerWidth()-W+"px");d=r.outerHeight(),h=d/a,f&&((M=Math.ceil(1/u*I))>o.horizontalDragMaxWidth?M=o.horizontalDragMaxWidth:M<o.horizontalDragMinWidth&&(M=o.horizontalDragMinWidth),v.width(M+"px"),_=I-M,te(b));p&&((T=Math.ceil(1/h*j))>o.verticalDragMaxHeight?T=o.verticalDragMaxHeight:T<o.verticalDragMinHeight&&(T=o.verticalDragMinHeight),g.height(T+"px"),w=j-T,Z(m))}(),k&&(ie(he?c-s:A,!1),ne(ue?d-a:L,!1)),r.find(":input,a").unbind("focus.jsp").bind("focus.jsp",(function(e){oe(e.target,!1)})),l.unbind(Y).bind(Y,(function(e,t,n,i){var r=b,s=m;return O.scrollBy(n*o.mouseWheelSpeed,-i*o.mouseWheelSpeed,!1),r==b&&s==m})),function(){var e,t,n,i,o,r=!1;l.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",(function(s){var a=s.originalEvent.touches[0];e=re(),t=se(),n=a.pageX,i=a.pageY,o=!1,r=!0})).bind("touchmove.jsp",(function(s){if(r){var a=s.originalEvent.touches[0],l=b,c=m;return O.scrollTo(e+n-a.pageX,t+i-a.pageY),o=o||Math.abs(n-a.pageX)>5||Math.abs(i-a.pageY)>5,l==b&&c==m}})).bind("touchend.jsp",(function(e){r=!1})).bind("click.jsp-touchclick",(function(e){if(o)return o=!1,!1}))}(),o.enableKeyboardNavigation&&function(){var n,i,s=[];f&&s.push(S[0]),p&&s.push(x[0]),r.focus((function(){t.focus()})),t.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",(function(t){if(t.target===this||s.length&&e(t.target).closest(s).length){var o=b,r=m;switch(t.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:n=t.keyCode,c();break;case 35:ne(d-a),n=null;break;case 36:ne(0),n=null}return!(i=t.keyCode==n&&o!=b||r!=m)}})).bind("keypress.jsp",(function(e){return e.keyCode==n&&c(),!i})),o.hideFocus?(t.css("outline","none"),"hideFocus"in l[0]&&t.attr("hideFocus",!0)):(t.css("outline",""),"hideFocus"in l[0]&&t.attr("hideFocus",!1));function c(){var e=b,t=m;switch(n){case 40:O.scrollByY(o.keyboardSpeed,!1);break;case 38:O.scrollByY(-o.keyboardSpeed,!1);break;case 34:case 32:O.scrollByY(a*o.scrollPagePercent,!1);break;case 33:O.scrollByY(-a*o.scrollPagePercent,!1);break;case 39:O.scrollByX(o.keyboardSpeed,!1);break;case 37:O.scrollByX(-o.keyboardSpeed,!1)}return i=e!=b||t!=m}}(),o.clickOnTrack&&function(){Q(),p&&y.bind("mousedown.jsp",(function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var i,r=e(this),s=r.offset(),l=t.pageY-s.top-m,c=!0,u=function(){var e=r.offset(),n=t.pageY-e.top-T/2,s=a*o.scrollPagePercent,p=w*s/(d-a);if(l<0)m-p>n?O.scrollByY(-s):K(n);else{if(!(l>0))return void h();m+p<n?O.scrollByY(s):K(n)}i=setTimeout(u,c?o.initialDelay:o.trackClickRepeatFreq),c=!1},h=function(){i&&clearTimeout(i),i=null,e(document).unbind("mouseup.jsp",h)};return u(),e(document).bind("mouseup.jsp",h),!1}}));f&&E.bind("mousedown.jsp",(function(t){if(t.originalTarget===n||t.originalTarget==t.currentTarget){var i,r=e(this),a=r.offset(),l=t.pageX-a.left-b,d=!0,u=function(){var e=r.offset(),n=t.pageX-e.left-M/2,a=s*o.scrollPagePercent,p=_*a/(c-s);if(l<0)b-p>n?O.scrollByX(-a):ee(n);else{if(!(l>0))return void h();b+p<n?O.scrollByX(a):ee(n)}i=setTimeout(u,d?o.initialDelay:o.trackClickRepeatFreq),d=!1},h=function(){i&&clearTimeout(i),i=null,e(document).unbind("mouseup.jsp",h)};return u(),e(document).bind("mouseup.jsp",h),!1}}))}(),function(){if(location.hash&&location.hash.length>1){var t,n,i=escape(location.hash);try{t=e(i)}catch(e){return}t.length&&r.find(i)&&(0===l.scrollTop()?n=setInterval((function(){l.scrollTop()>0&&(oe(i,!0),e(document).scrollTop(l.position().top),clearInterval(n))}),50):(oe(i,!0),e(document).scrollTop(l.position().top)))}}(),o.hijackInternalLinks&&ce()):(t.removeClass("jspScrollable"),r.css({top:0,width:l.width()-W}),l.unbind(Y),r.find(":input,a").unbind("focus.jsp"),t.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp"),Q(),le()),o.autoReinitialise&&!H?H=setInterval((function(){z(o)}),o.autoReinitialiseDelay):!o.autoReinitialise&&H&&clearInterval(H),G&&t.scrollTop(0)&&ne(G,!1),F&&t.scrollLeft(0)&&ie(F,!1),t.trigger("jsp-initialised",[f||p])}function X(){y.height(j+"px"),m=0,k=o.verticalGutter+y.outerWidth(),r.width(s-k-W);try{0===x.position().left&&r.css("margin-left",k+"px")}catch(e){}}function U(){l.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each((function(){I-=e(this).outerWidth()})),E.width(I+"px"),b=0}function J(e,t,n,i){var o,r="before",s="after";"os"==t&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==r?s=t:t==s&&(r=t,o=n,n=i,i=o),e[r](n)[s](i)}function q(t,n,i){return function(){return function(t,n,i,r){i=e(i).addClass("jspActive");var s,a,l=!0,c=function(){0!==t&&O.scrollByX(t*o.arrowButtonSpeed),0!==n&&O.scrollByY(n*o.arrowButtonSpeed),a=setTimeout(c,l?o.initialDelay:o.arrowRepeatFreq),l=!1};c(),s=r?"mouseout.jsp":"mouseup.jsp",(r=r||e("html")).bind(s,(function(){i.removeClass("jspActive"),a&&clearTimeout(a),a=null,r.unbind(s)}))}(t,n,this,i),this.blur(),!1}}function Q(){E&&E.unbind("mousedown.jsp"),y&&y.unbind("mousedown.jsp")}function V(){e("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),g&&g.removeClass("jspActive"),v&&v.removeClass("jspActive")}function K(e,t){p&&(e<0?e=0:e>w&&(e=w),t===n&&(t=o.animateScroll),t?O.animate(g,"top",e,Z):(g.css("top",e),Z(e)))}function Z(e){e===n&&(e=g.position().top),l.scrollTop(0);var i=0===(m=e),s=m==w,c=-(e/w)*(d-a);A==i&&R==s||(A=i,R=s,t.trigger("jsp-arrow-change",[A,R,L,G])),function(e,t){o.showArrows&&($[e?"addClass":"removeClass"]("jspDisabled"),C[t?"addClass":"removeClass"]("jspDisabled"))}(i,s),r.css("top",c),t.trigger("jsp-scroll-y",[-c,i,s]).trigger("scroll")}function ee(e,t){f&&(e<0?e=0:e>_&&(e=_),t===n&&(t=o.animateScroll),t?O.animate(v,"left",e,te):(v.css("left",e),te(e)))}function te(e){e===n&&(e=v.position().left),l.scrollTop(0);var i=0===(b=e),a=b==_,d=-(e/_)*(c-s);L==i&&G==a||(L=i,G=a,t.trigger("jsp-arrow-change",[A,R,L,G])),function(e,t){o.showArrows&&(N[e?"addClass":"removeClass"]("jspDisabled"),B[t?"addClass":"removeClass"]("jspDisabled"))}(i,a),r.css("left",d),t.trigger("jsp-scroll-x",[-d,i,a]).trigger("scroll")}function ne(e,t){K(e/(d-a)*w,t)}function ie(e,t){ee(e/(c-s)*_,t)}function oe(t,n,i){var r,c,d,u,h,p,f,g,w,m=0,v=0;try{r=e(t)}catch(e){return}for(c=r.outerHeight(),d=r.outerWidth(),l.scrollTop(0),l.scrollLeft(0);!r.is(".jspPane");)if(m+=r.position().top,v+=r.position().left,r=r.offsetParent(),/^body|html$/i.test(r[0].nodeName))return;p=(u=se())+a,m<u||n?g=m-o.verticalGutter:m+c>p&&(g=m-a+c+o.verticalGutter),g&&ne(g,i),f=(h=re())+s,v<h||n?w=v-o.horizontalGutter:v+d>f&&(w=v-s+d+o.horizontalGutter),w&&ie(w,i)}function re(){return-r.position().left}function se(){return-r.position().top}function ae(){return!1}function le(){e("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function ce(){le(),e("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",(function(){var e,t=this.href.split("#");if(t.length>1&&(e=t[1]).length>0&&r.find("#"+e).length>0)return oe("#"+e,!0),!1}))}P=t.css("paddingTop")+" "+t.css("paddingRight")+" "+t.css("paddingBottom")+" "+t.css("paddingLeft"),W=(parseInt(t.css("paddingLeft"),10)||0)+(parseInt(t.css("paddingRight"),10)||0),e.extend(O,{reinitialise:function(t){z(t=e.extend({},o,t))},scrollToElement:function(e,t,n){oe(e,t,n)},scrollTo:function(e,t,n){ie(e,n),ne(t,n)},scrollToX:function(e,t){ie(e,t)},scrollToY:function(e,t){ne(e,t)},scrollToPercentX:function(e,t){ie(e*(c-s),t)},scrollToPercentY:function(e,t){ne(e*(d-a),t)},scrollBy:function(e,t,n){O.scrollByX(e,n),O.scrollByY(t,n)},scrollByX:function(e,t){ee((re()+Math[e<0?"floor":"ceil"](e))/(c-s)*_,t)},scrollByY:function(e,t){K((se()+Math[e<0?"floor":"ceil"](e))/(d-a)*w,t)},positionDragX:function(e,t){ee(e,t)},positionDragY:function(e,t){K(e,t)},animate:function(e,t,n,i){var r={};r[t]=n,e.animate(r,{duration:o.animateDuration,easing:o.animateEase,queue:!1,step:i})},getContentPositionX:function(){return re()},getContentPositionY:function(){return se()},getContentWidth:function(){return c},getContentHeight:function(){return d},getPercentScrolledX:function(){return re()/(c-s)},getPercentScrolledY:function(){return se()/(d-a)},getIsScrollableH:function(){return f},getIsScrollableV:function(){return p},getContentPane:function(){return r},scrollToBottom:function(e){K(w,e)},hijackInternalLinks:function(){ce()},destroy:function(){var e,n;e=se(),n=re(),t.removeClass("jspScrollable").unbind(".jsp"),t.replaceWith(F.append(r.children())),F.scrollTop(e),F.scrollLeft(n)}}),z(i)}return t=e.extend({},e.fn.jScrollPane.defaults,t),e.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],(function(){t[this]=t[this]||t.speed})),this.each((function(){var n=e(this),o=n.data("jsp");o?o.reinitialise(t):(o=new i(n,t),n.data("jsp",o))}))},e.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery);
